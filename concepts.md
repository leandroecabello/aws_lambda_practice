## Serverless con AWS - Conceptos

ü§î ### **¬øQu√© es Serverless?** 

>  *Serverless es una forma de ejecutar servicios en la nube sin necesidad de administrar servidores. En lugar de mantener una infraestructura activa todo el tiempo, las funciones o servicios se ejecutan solo cuando ocurre un evento, lo que permite escalar autom√°ticamente y pagar √∫nicamente por lo que se utiliza. Es ideal para arquitecturas orientadas a eventos y microservicios.* 

---

## ‚úÖ Conceptos a tener en cuenta

### 1. AWS Lambda

- **Qu√© es**: Funciones que se ejecutan sin servidor. No administr√°s infraestructura.
- **Casos de uso**: Procesar eventos (subida a S3, mensaje en SQS, endpoint de API Gateway).
- **Ventajas**: Escalado autom√°tico, pago por uso, sin mantenimiento de infraestructura.
- **Ejemplo**: Subida de archivo en S3 ‚Üí Lambda procesa imagen.

    >üí° *Una Lambda permite ejecutar l√≥gica de backend sin preocuparnos por servidores. Es ideal para eventos puntuales y escalabilidad autom√°tica.*

#### Mermaid
```mermaid
sequenceDiagram
    participant Evento
    participant Lambda
    participant Servicio

    Evento->>Lambda: Dispara funci√≥n Lambda
    Lambda->>Servicio: Ejecuta l√≥gica
    Servicio-->>Lambda: Respuesta
    Lambda-->>Evento: Resultado
```

#### Diagrama
![Diagrama_Lambda](./assets/diagrams/lambda-flow.png)

### 2. API Gateway

- **Qu√© es**: Servicio para exponer Lambdas como endpoints HTTP.
- **Casos de uso**: APIs REST/HTTP, validaci√≥n, autenticaci√≥n, logging.
- **Ventajas**: Integraci√≥n sencilla con Lambda, manejo de autenticaci√≥n, escalabilidad.
- **Ejemplo**: Recibir una petici√≥n HTTP ‚Üí API Gateway valida y redirige a una Lambda.

    >üí° *API Gateway permite crear APIs seguras y escalables, conectando f√°cilmente clientes HTTP con funciones Lambda.*

#### Mermaid

```mermaid
sequenceDiagram
    participant Usuario as Usuario (cliente web o m√≥vil)
    participant APIGW as API Gateway
    participant Lambda as AWS Lambda
    participant DB as DynamoDB

    Usuario->>APIGW: Solicitud HTTP (GET / POST / etc.)
    APIGW->>Lambda: Invocar funci√≥n Lambda
    Lambda->>DB: Leer / escribir datos
    DB-->>Lambda: Respuesta de la base
    Lambda-->>APIGW: Resultado de la l√≥gica
    APIGW-->>Usuario: Respuesta HTTP final
```
#### Diagrama
![Diagrama_API_Gateway](./assets/diagrams/api_gateway.png)

### 3. SQS (Simple Queue Service)

- **Qu√© es**: Cola de mensajes FIFO o standard.
- **Casos de uso**: Desacoplar productores/consumidores, procesamiento en background.
- **Ventajas**: Retry autom√°tico, procesamiento as√≠ncrono, resiliencia.
- **Ejemplo**: Servicio web env√≠a tarea pesada a SQS ‚Üí Lambda consume mensajes y procesa en background.

    >üí° *SQS ayuda a desacoplar servicios y manejar cargas variables, asegurando que las tareas se procesen sin perder mensajes.*

#### Mermaid
```mermaid
sequenceDiagram
    participant Producer as Servicio productor
    participant SQS as AWS SQS
    participant Lambda as AWS Lambda (consumidor)
    participant Service as Servicio externo (ej. DynamoDB)

    Producer->>SQS: Enviar mensaje
    SQS->>Lambda: Disparar funci√≥n por nuevo mensaje
    Lambda->>Service: Procesar mensaje (guardar, notificar, etc.)
    Service-->>Lambda: Respuesta (opcional)
```
```mermaid
sequenceDiagram
    participant Producer as Servicio productor
    participant SQS as AWS SQS (FIFO)
    participant Lambda as AWS Lambda (consumidor)
    participant Service as Servicio externo (ej. DynamoDB)

    Producer->>SQS: Enviar mensaje (con MessageGroupId y DeduplicationId)
    Note right of SQS: Garantiza orden y evita duplicados
    SQS->>Lambda: Disparar funci√≥n en orden por grupo
    Lambda->>Service: Procesar mensaje
    Service-->>Lambda: Respuesta (opcional)
```
#### Diagrama
##### a. SQS Standard
![Diagrama_SQS_Standard](./assets/diagrams/sqs_standar.png)

##### b. SQS FIFO
![Diagrama_SQS_FIFO](./assets/diagrams/sqs_fifo.png)


### 4. SNS (Simple Notification Service)

- **Qu√© es**: Sistema pub/sub para notificaciones.
- **Casos de uso**: Enviar un mensaje a m√∫ltiples destinos (Lambda, SQS, Email).
- **Ventajas**: Simplicidad, broadcast de eventos.
- **Ejemplo**: Evento importante ‚Üí SNS notifica por email y dispara una Lambda en paralelo.

    >üí° *SNS permite notificar m√∫ltiples sistemas ante un mismo evento, facilitando la comunicaci√≥n y el broadcast de mensajes.*

#### Mermaid
```mermaid
sequenceDiagram
    participant Publisher as Servicio publicador
    participant SNS as SNS Topic
    participant Lambda1 as Lambda A (suscriptor)
    participant SQS as SQS (suscriptor)
    participant Email as Email (notificaci√≥n)

    Publisher->>SNS: Publicar mensaje
    SNS->>Lambda1: Entregar mensaje (ejecutar Lambda)
    SNS->>SQS: Encolar mensaje
    SNS->>Email: Enviar notificaci√≥n por email
```
#### Diagrama
![Diagrama_SNS](./assets/diagrams/sns.png)

### 5. Step Functions

- **Qu√© es**: Servicio para orquestar flujos de tareas.
- **Casos de uso**: Procesos con m√∫ltiples pasos, l√≥gica condicional, retries.
- **Ventajas**: Separaci√≥n de l√≥gica de control, visibilidad del flujo, reintentos.
- **Ejemplo**: Proceso de registro de usuario ‚Üí Step Functions coordina varias Lambdas (validaci√≥n, guardado, notificaci√≥n).

    >üí° *Step Functions permiten definir procesos complejos entre Lambdas, separando la l√≥gica de control y facilitando la orquestaci√≥n.*

#### Mermaid
```mermaid
sequenceDiagram
    participant StepFunc as Step Function
    participant Lambda1 as Lambda: Validar datos
    participant Lambda2 as Lambda: Guardar en DB
    participant Lambda3 as Lambda: Notificar

    StepFunc->>Lambda1: Ejecutar paso 1 (Validar datos)
    Lambda1-->>StepFunc: Resultado validaci√≥n

    alt Datos v√°lidos
        StepFunc->>Lambda2: Ejecutar paso 2 (Guardar en DB)
        Lambda2-->>StepFunc: Resultado guardado

        StepFunc->>Lambda3: Ejecutar paso 3 (Enviar notificaci√≥n)
        Lambda3-->>StepFunc: OK
    else Datos inv√°lidos
        StepFunc-->>StepFunc: Finaliza con error
    end
```
#### Diagrama
![Diagrama_Step_function](./assets/diagrams/step_function.png)

### 6. DynamoDB

- **Qu√© es**: Base de datos NoSQL totalmente gestionada.
- **Casos de uso**: Alta velocidad de lectura/escritura, sin relaciones complejas.
- **Ventajas**: Escalabilidad autom√°tica, baja latencia, TTL, streams.
- **Ejemplo**: Aplicaci√≥n serverless almacena sesiones de usuario en DynamoDB para acceso r√°pido.

    >üí° *DynamoDB es ideal cuando se necesita velocidad y escalabilidad, con una estructura simple de datos y sin preocuparse por la administraci√≥n de la base.*

#### Mermaid
```mermaid
sequenceDiagram
    participant Cliente as Cliente (API Gateway o evento)
    participant Lambda as AWS Lambda
    participant DynamoDB as DynamoDB

    Cliente->>Lambda: Invocar funci√≥n Lambda
    Lambda->>DynamoDB: Leer / Escribir datos
    DynamoDB-->>Lambda: Resultado operaci√≥n
    Lambda-->>Cliente: Respuesta procesada
```
#### Diagrama
![Diagrama_Dynamo](./assets/diagrams/dynamo_db.png)

### 7. Serverless Framework

- **Qu√© es**: Framework de infraestructura como c√≥digo para desplegar servicios serverless en AWS y otros proveedores.
- **Casos de uso**: Crear y desplegar Lambdas, API Gateway, SQS, DynamoDB, todo desde archivos YAML.
- **Ventajas**: Automatizaci√≥n, reutilizaci√≥n, despliegues r√°pidos y consistentes.
- **Ejemplo**: Definir funciones Lambda y recursos en YAML ‚Üí Desplegar todo con un solo comando.

    >üí° *Serverless Framework permite definir y desplegar infraestructura y funciones serverless de forma sencilla y repetible, facilitando la automatizaci√≥n y el versionado.*

#### Mermaid
```mermaid
sequenceDiagram
    participant Dev as Desarrollador
    participant SLS as Serverless Framework CLI
    participant CFN as AWS CloudFormation
    participant AWS as Servicios AWS (Lambda, API Gateway, etc.)

    Dev->>SLS: sls deploy
    SLS->>CFN: Genera y env√≠a plantilla YAML
    CFN->>AWS: Provisiona recursos declarados
    AWS-->>CFN: Confirmaci√≥n de creaci√≥n
    CFN-->>SLS: Stack creado / actualizado
    SLS-->>Dev: Resultado del despliegue
```
#### Diagrama
![Diagrama_Serverless_Framework](./assets/diagrams/serverless_framework.png)

### 8. AWS CloudFormation

- **Qu√© es**: Servicio nativo de AWS para definir y provisionar infraestructura como c√≥digo.
- **Casos de uso**: Declarar recursos (Lambdas, colas, tablas, APIs) en plantillas YAML/JSON.
- **Ventajas**: Control de cambios, versionado, integraci√≥n con CI/CD.
- **Ejemplo**: Crear una plantilla YAML con recursos ‚Üí CloudFormation los provisiona y gestiona cambios.

    >üí° *CloudFormation permite gestionar toda la infraestructura AWS como c√≥digo, garantizando reproducibilidad y trazabilidad de cambios.*

    >‚ÑπÔ∏è *Dato adicional: AWS CDK (Cloud Development Kit) permite escribir esa infraestructura como c√≥digo usando lenguajes como TypeScript o Python. El CDK genera plantillas de CloudFormation por debajo*

#### Mermaid
```mermaid
sequenceDiagram
    participant Cliente as Cliente (API Gateway o evento)
    participant Lambda as AWS Lambda
    participant DynamoDB as DynamoDB

    Cliente->>Lambda: Invocar funci√≥n Lambda
    Lambda->>DynamoDB: Leer / Escribir datos
    DynamoDB-->>Lambda: Resultado operaci√≥n
    Lambda-->>Cliente: Respuesta procesada
```
#### Diagrama
![Diagrama_Cloud_Formation](./assets/diagrams/cloud_formation.png)

---

### üÜö Comparaci√≥n entre Serverless Framework y CloudFormatio : 
Tanto `Serverless Framework` como `CloudFormation` permiten definir infraestructura como c√≥digo, pero con enfoques diferentes:

- ***CloudFormation*** es el motor nativo de AWS, donde se describe cada recurso manualmente en YAML o JSON.
- ***Serverless Framework*** es un framework externo que se abstrae de muchos detalles y genera internamente plantillas de `CloudFormation` por nosotros. Es m√°s enfocado a aplicaciones serverless, con una sintaxis m√°s simple y r√°pida para desarrolladores.
    
    > üìë *En resumen: Serverless Framework simplifica y automatiza el uso de CloudFormation.*
